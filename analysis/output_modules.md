# Анализ на модулите за изходни данни

## output_handler.py - Генериране на изходни данни

### Основни класове:

**`InteractiveMapGenerator`**
Генератор на интерактивна карта с Folium:

**Атрибути:**
- `config` - OutputConfig настройки
- `central_matrix` - централна OSRM матрица за геометрия
- `use_osrm_routing` - дали да използва OSRM маршрути

**Ключови методи:**
- `create_map()` - създава интерактивна карта
- `_add_depot_marker()` - добавя маркер за депото
- `_add_routes_to_map()` - добавя маршрутите
- `_get_osrm_route_geometry()` - получава реална геометрия
- `_add_legend()` - добавя легенда

**Визуални елементи:**
- Номерирани маркери за клиенти
- Цветни маршрути за всеки автобус
- Popup информация с детайли
- Интерактивна легенда
- OSRM геометрия на маршрутите

**Цветова схема:**
- 20 уникални цвята за автобуси
- Чернен маркер за депото
- Fallback пунктирани линии при липса на OSRM

**`ExcelExporter`**
Експортър на Excel файлове:

**Методи:**
- `export_warehouse_orders()` - складови заявки
- `export_vehicle_routes()` - маршрути по автобуси

**Excel структури:**

*Warehouse Orders:*
- ID клиент
- Име клиент  
- Обем (ст.)
- GPS координати
- Latitude/Longitude

*Vehicle Routes:*
- Номер маршрут
- Тип превозно средство
- Ред в маршрута
- Данни за клиента

**`OutputHandler`**
Главен клас за координиране на изходите:

**Компоненти:**
- `map_generator` - генератор на карти
- `excel_exporter` - експортър на Excel

**Методи:**
- `generate_all_outputs()` - генерира всички изходи
- Връща речник с пътищата до файловете

### Технически детайли:

**Folium интеграция:**
- OpenStreetMap tiles
- Responsive дизайн
- Popup с HTML форматиране
- Custom CSS стилизация

**OSRM геометрия:**
- Реални маршрути вместо прави линии
- Fallback при липса на OSRM данни
- Кеширане на геометрията

**Маркери система:**
- DivIcon за номерирани маркери
- Уникални цветове за всеки автобус
- Tooltip с кратка информация
- Popup с пълни детайли

**Excel форматиране:**
- pandas DataFrame структури
- openpyxl engine за писане
- UTF-8 encoding за кирилица
- Автоматично създаване на директории

**Файлова структура:**
```
output/
├── interactive_map.html
├── excel/
│   ├── warehouse_orders.xlsx
│   └── vehicle_routes.xlsx
└── charts/
    └── (бъдещи чартове)
```

### Конфигурационни опции:

**Карта настройки:**
- `enable_interactive_map` - включва картата
- `map_zoom_level` - ниво на zoom
- `show_route_colors` - цветни маршрути
- `show_vehicle_info` - информация за превозните средства

**Excel настройки:**
- `excel_output_dir` - директория за Excel файлове
- `warehouse_excel_file` - име на складовия файл
- `routes_excel_file` - име на маршрутния файл

**Визуални подобрения:**
- Custom легенда с HTML/CSS
- Responsive дизайн за мобилни устройства
- Hover ефекти на маркерите
- Филтриране по автобуси (бъдеща функция)

### VEHICLE_SETTINGS конфигурация:

**Типове превозни средства:**
- `internal_bus` - син цвят, bus икона
- `center_bus` - червен цвят, building икона
- `external_bus` - зелен цвят, truck икона

**BUS_COLORS палитра:**
20 различни цвята за уникална идентификация на всеки автобус

### Грешки и обработка:

**OSRM fallback:**
- Автоматично превключване към прави линии
- Визуални индикатори за fallback режим
- Логиране на грешките

**Файлова система:**
- Автоматично създаване на директории
- Обработка на permissions грешки
- Резервни имена на файлове

**Encoding:**
- UTF-8 за кирилица
- HTML escape за специални символи
- Правилно форматиране на координати 